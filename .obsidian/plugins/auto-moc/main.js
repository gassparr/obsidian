/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// main.ts
__export(exports, {
  default: () => AutoMOC
});
var import_obsidian = __toModule(require("obsidian"));
var DEFAULT_SETTINGS = {
  showRibbonButton: true
};
var AutoMOC = class extends import_obsidian.Plugin {
  getPresentLinks(currFilePath) {
    const allLinks = this.app.metadataCache.resolvedLinks;
    const presentLinks = Object.keys(allLinks[currFilePath]);
    return presentLinks;
  }
  getLinkedMentions(currFilePath) {
    const allLinks = this.app.metadataCache.resolvedLinks;
    let linkedMentions = [];
    console.log(allLinks);
    Object.keys(allLinks).forEach((key) => {
      if (currFilePath in allLinks[key]) {
        linkedMentions.push(key);
      }
    });
    return linkedMentions;
  }
  addMissingLinks(activeFileView, presentLinks, allLinkedMentions) {
    let addFlag = false;
    for (const path of allLinkedMentions) {
      if (!presentLinks.includes(path)) {
        let found = this.app.vault.getAbstractFileByPath(path);
        if (found instanceof import_obsidian.TFile) {
          activeFileView.editor.replaceSelection(this.app.fileManager.generateMarkdownLink(found, activeFileView.file.path) + "\n");
          addFlag = true;
        }
      }
    }
    if (!addFlag)
      new import_obsidian.Notice("No new links found");
  }
  runAutoMOC() {
    const view = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
    if (view != null && view.file.extension === "md") {
      new import_obsidian.Notice("Linking mentions");
      const presentLinks = this.getPresentLinks(view.file.path);
      const linkedMentions = this.getLinkedMentions(view.file.path);
      this.addMissingLinks(view, presentLinks, linkedMentions);
    } else {
      new import_obsidian.Notice("Failed to link mentions, file type is not a markdown file");
    }
  }
  onload() {
    return __async(this, null, function* () {
      yield this.loadSettings();
      if (this.settings.showRibbonButton) {
        const ribbonIconEl = this.addRibbonIcon("sheets-in-box", "AutoMOC", (evt) => {
          this.runAutoMOC();
        });
      }
      this.addCommand({
        id: "add-missing-linked-mentions",
        name: "Add missing linked mentions at cursor position",
        editorCallback: (editor, view) => {
          this.runAutoMOC();
        }
      });
      this.addSettingTab(new AutoMOCSettingTab(this.app, this));
    });
  }
  onunload() {
  }
  loadSettings() {
    return __async(this, null, function* () {
      this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
    });
  }
  saveSettings() {
    return __async(this, null, function* () {
      yield this.saveData(this.settings);
    });
  }
};
var AutoMOCSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Show ribbon button").setDesc("Enable or disable the ribbon button for this plugin. You can still run the plugin with a hotkey (requires restart)").addToggle((toggle) => {
      toggle.setValue(this.plugin.settings.showRibbonButton).onChange((showRibbonButton) => {
        this.plugin.settings.showRibbonButton = showRibbonButton;
        this.plugin.saveSettings();
      });
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHtcclxuXHRBcHAsXHJcblx0RWRpdG9yLFxyXG5cdE1hcmtkb3duVmlldyxcclxuXHROb3RpY2UsXHJcblx0UGx1Z2luLFxyXG5cdFBsdWdpblNldHRpbmdUYWIsXHJcblx0U2V0dGluZyxcclxuXHRURmlsZSxcclxufSBmcm9tIFwib2JzaWRpYW5cIjtcclxuXHJcbmludGVyZmFjZSBBdXRvTU9DU2V0dGluZ3Mge1xyXG5cdHNob3dSaWJib25CdXR0b246IGJvb2xlYW47XHJcbn1cclxuXHJcbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IEF1dG9NT0NTZXR0aW5ncyA9IHtcclxuXHRzaG93UmliYm9uQnV0dG9uOiB0cnVlLFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXV0b01PQyBleHRlbmRzIFBsdWdpbiB7XHJcblx0c2V0dGluZ3M6IEF1dG9NT0NTZXR0aW5ncztcclxuXHJcblx0Z2V0UHJlc2VudExpbmtzKGN1cnJGaWxlUGF0aDogc3RyaW5nKSB7XHJcblx0XHRjb25zdCBhbGxMaW5rcyA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUucmVzb2x2ZWRMaW5rcztcclxuXHRcdGNvbnN0IHByZXNlbnRMaW5rcyA9IE9iamVjdC5rZXlzKGFsbExpbmtzW2N1cnJGaWxlUGF0aF0pO1xyXG5cclxuXHRcdHJldHVybiBwcmVzZW50TGlua3M7XHJcblx0fVxyXG5cclxuXHRnZXRMaW5rZWRNZW50aW9ucyhjdXJyRmlsZVBhdGg6IHN0cmluZykge1xyXG5cdFx0Y29uc3QgYWxsTGlua3MgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLnJlc29sdmVkTGlua3M7XHJcblx0XHRsZXQgbGlua2VkTWVudGlvbnM6IEFycmF5PHN0cmluZz4gPSBbXTtcclxuXHRcdGNvbnNvbGUubG9nKGFsbExpbmtzKTtcclxuXHRcdE9iamVjdC5rZXlzKGFsbExpbmtzKS5mb3JFYWNoKChrZXkpID0+IHtcclxuXHRcdFx0aWYgKGN1cnJGaWxlUGF0aCBpbiBhbGxMaW5rc1trZXldKSB7XHJcblx0XHRcdFx0bGlua2VkTWVudGlvbnMucHVzaChrZXkpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHJcblx0XHRyZXR1cm4gbGlua2VkTWVudGlvbnM7XHJcblx0fVxyXG5cclxuXHRhZGRNaXNzaW5nTGlua3MoXHJcblx0XHRhY3RpdmVGaWxlVmlldzogTWFya2Rvd25WaWV3LFxyXG5cdFx0cHJlc2VudExpbmtzOiBBcnJheTxzdHJpbmc+LFxyXG5cdFx0YWxsTGlua2VkTWVudGlvbnM6IEFycmF5PHN0cmluZz5cclxuXHQpIHtcclxuXHRcdGxldCBhZGRGbGFnID0gZmFsc2U7XHJcblxyXG5cdFx0Ly9jaGVja3MgZm9yIG1pc3NpbmcgbGlua3MgYW5kIGFkZHMgdGhlbVxyXG5cdFx0Zm9yIChjb25zdCBwYXRoIG9mIGFsbExpbmtlZE1lbnRpb25zKSB7XHJcblx0XHRcdGlmICghcHJlc2VudExpbmtzLmluY2x1ZGVzKHBhdGgpKSB7XHJcblx0XHRcdFx0bGV0IGZvdW5kID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHBhdGgpO1xyXG5cclxuXHRcdFx0XHRpZiAoZm91bmQgaW5zdGFuY2VvZiBURmlsZSkge1xyXG5cdFx0XHRcdFx0YWN0aXZlRmlsZVZpZXcuZWRpdG9yLnJlcGxhY2VTZWxlY3Rpb24oXHJcblx0XHRcdFx0XHRcdHRoaXMuYXBwLmZpbGVNYW5hZ2VyLmdlbmVyYXRlTWFya2Rvd25MaW5rKFxyXG5cdFx0XHRcdFx0XHRcdGZvdW5kLFxyXG5cdFx0XHRcdFx0XHRcdGFjdGl2ZUZpbGVWaWV3LmZpbGUucGF0aFxyXG5cdFx0XHRcdFx0XHQpICsgXCJcXG5cIlxyXG5cdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdGFkZEZsYWcgPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGlmICghYWRkRmxhZykgbmV3IE5vdGljZShcIk5vIG5ldyBsaW5rcyBmb3VuZFwiKTtcclxuXHR9XHJcblxyXG5cdHJ1bkF1dG9NT0MoKSB7XHJcblx0XHRjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcclxuXHJcblx0XHRpZiAodmlldyAhPSBudWxsICYmIHZpZXcuZmlsZS5leHRlbnNpb24gPT09IFwibWRcIikge1xyXG5cdFx0XHRuZXcgTm90aWNlKFwiTGlua2luZyBtZW50aW9uc1wiKTtcclxuXHRcdFx0Y29uc3QgcHJlc2VudExpbmtzID0gdGhpcy5nZXRQcmVzZW50TGlua3Modmlldy5maWxlLnBhdGgpOyAvLyBsaW5rcyBhbHJlYWR5IGluIHRoZSBkb2N1bWVudFxyXG5cdFx0XHRjb25zdCBsaW5rZWRNZW50aW9ucyA9IHRoaXMuZ2V0TGlua2VkTWVudGlvbnModmlldy5maWxlLnBhdGgpOyAvLyBhbGwgbGlua2VkIG1lbnRpb25zIGV2ZW4gdGhvc2Ugbm90IHByZXNlbnRcclxuXHJcblx0XHRcdHRoaXMuYWRkTWlzc2luZ0xpbmtzKHZpZXcsIHByZXNlbnRMaW5rcywgbGlua2VkTWVudGlvbnMpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0bmV3IE5vdGljZShcclxuXHRcdFx0XHRcIkZhaWxlZCB0byBsaW5rIG1lbnRpb25zLCBmaWxlIHR5cGUgaXMgbm90IGEgbWFya2Rvd24gZmlsZVwiXHJcblx0XHRcdCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRhc3luYyBvbmxvYWQoKSB7XHJcblx0XHRhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xyXG5cclxuXHRcdGlmICh0aGlzLnNldHRpbmdzLnNob3dSaWJib25CdXR0b24pIHtcclxuXHRcdFx0Y29uc3QgcmliYm9uSWNvbkVsID0gdGhpcy5hZGRSaWJib25JY29uKFxyXG5cdFx0XHRcdFwic2hlZXRzLWluLWJveFwiLFxyXG5cdFx0XHRcdFwiQXV0b01PQ1wiLFxyXG5cdFx0XHRcdChldnQ6IE1vdXNlRXZlbnQpID0+IHtcclxuXHRcdFx0XHRcdHRoaXMucnVuQXV0b01PQygpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0KTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmFkZENvbW1hbmQoe1xyXG5cdFx0XHRpZDogXCJhZGQtbWlzc2luZy1saW5rZWQtbWVudGlvbnNcIixcclxuXHRcdFx0bmFtZTogXCJBZGQgbWlzc2luZyBsaW5rZWQgbWVudGlvbnMgYXQgY3Vyc29yIHBvc2l0aW9uXCIsXHJcblx0XHRcdGVkaXRvckNhbGxiYWNrOiAoZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duVmlldykgPT4ge1xyXG5cdFx0XHRcdHRoaXMucnVuQXV0b01PQygpO1xyXG5cdFx0XHR9LFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0dGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBBdXRvTU9DU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xyXG5cdH1cclxuXHJcblx0b251bmxvYWQoKSB7fVxyXG5cclxuXHRhc3luYyBsb2FkU2V0dGluZ3MoKSB7XHJcblx0XHR0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbihcclxuXHRcdFx0e30sXHJcblx0XHRcdERFRkFVTFRfU0VUVElOR1MsXHJcblx0XHRcdGF3YWl0IHRoaXMubG9hZERhdGEoKVxyXG5cdFx0KTtcclxuXHR9XHJcblxyXG5cdGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcclxuXHRcdGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBBdXRvTU9DU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xyXG5cdHBsdWdpbjogQXV0b01PQztcclxuXHJcblx0Y29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogQXV0b01PQykge1xyXG5cdFx0c3VwZXIoYXBwLCBwbHVnaW4pO1xyXG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XHJcblx0fVxyXG5cclxuXHRkaXNwbGF5KCk6IHZvaWQge1xyXG5cdFx0Y29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcclxuXHJcblx0XHRjb250YWluZXJFbC5lbXB0eSgpO1xyXG5cclxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG5cdFx0XHQuc2V0TmFtZShcIlNob3cgcmliYm9uIGJ1dHRvblwiKVxyXG5cdFx0XHQuc2V0RGVzYyhcclxuXHRcdFx0XHRcIkVuYWJsZSBvciBkaXNhYmxlIHRoZSByaWJib24gYnV0dG9uIGZvciB0aGlzIHBsdWdpbi4gWW91IGNhbiBzdGlsbCBydW4gdGhlIHBsdWdpbiB3aXRoIGEgaG90a2V5IChyZXF1aXJlcyByZXN0YXJ0KVwiXHJcblx0XHRcdClcclxuXHRcdFx0LmFkZFRvZ2dsZSgodG9nZ2xlKSA9PiB7XHJcblx0XHRcdFx0dG9nZ2xlXHJcblx0XHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Muc2hvd1JpYmJvbkJ1dHRvbilcclxuXHRcdFx0XHRcdC5vbkNoYW5nZSgoc2hvd1JpYmJvbkJ1dHRvbikgPT4ge1xyXG5cdFx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5zaG93UmliYm9uQnV0dG9uID1cclxuXHRcdFx0XHRcdFx0XHRzaG93UmliYm9uQnV0dG9uO1xyXG5cdFx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHR9KTtcclxuXHR9XHJcbn1cclxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFTTztBQU1QLElBQU0sbUJBQW9DO0FBQUEsRUFDekMsa0JBQWtCO0FBQUE7QUFHbkIsNEJBQXFDLHVCQUFPO0FBQUEsRUFHM0MsZ0JBQWdCLGNBQXNCO0FBQ3JDLFVBQU0sV0FBVyxLQUFLLElBQUksY0FBYztBQUN4QyxVQUFNLGVBQWUsT0FBTyxLQUFLLFNBQVM7QUFFMUMsV0FBTztBQUFBO0FBQUEsRUFHUixrQkFBa0IsY0FBc0I7QUFDdkMsVUFBTSxXQUFXLEtBQUssSUFBSSxjQUFjO0FBQ3hDLFFBQUksaUJBQWdDO0FBQ3BDLFlBQVEsSUFBSTtBQUNaLFdBQU8sS0FBSyxVQUFVLFFBQVEsQ0FBQyxRQUFRO0FBQ3RDLFVBQUksZ0JBQWdCLFNBQVMsTUFBTTtBQUNsQyx1QkFBZSxLQUFLO0FBQUE7QUFBQTtBQUl0QixXQUFPO0FBQUE7QUFBQSxFQUdSLGdCQUNDLGdCQUNBLGNBQ0EsbUJBQ0M7QUFDRCxRQUFJLFVBQVU7QUFHZCxlQUFXLFFBQVEsbUJBQW1CO0FBQ3JDLFVBQUksQ0FBQyxhQUFhLFNBQVMsT0FBTztBQUNqQyxZQUFJLFFBQVEsS0FBSyxJQUFJLE1BQU0sc0JBQXNCO0FBRWpELFlBQUksaUJBQWlCLHVCQUFPO0FBQzNCLHlCQUFlLE9BQU8saUJBQ3JCLEtBQUssSUFBSSxZQUFZLHFCQUNwQixPQUNBLGVBQWUsS0FBSyxRQUNqQjtBQUVMLG9CQUFVO0FBQUE7QUFBQTtBQUFBO0FBS2IsUUFBSSxDQUFDO0FBQVMsVUFBSSx1QkFBTztBQUFBO0FBQUEsRUFHMUIsYUFBYTtBQUNaLFVBQU0sT0FBTyxLQUFLLElBQUksVUFBVSxvQkFBb0I7QUFFcEQsUUFBSSxRQUFRLFFBQVEsS0FBSyxLQUFLLGNBQWMsTUFBTTtBQUNqRCxVQUFJLHVCQUFPO0FBQ1gsWUFBTSxlQUFlLEtBQUssZ0JBQWdCLEtBQUssS0FBSztBQUNwRCxZQUFNLGlCQUFpQixLQUFLLGtCQUFrQixLQUFLLEtBQUs7QUFFeEQsV0FBSyxnQkFBZ0IsTUFBTSxjQUFjO0FBQUEsV0FDbkM7QUFDTixVQUFJLHVCQUNIO0FBQUE7QUFBQTtBQUFBLEVBS0csU0FBUztBQUFBO0FBQ2QsWUFBTSxLQUFLO0FBRVgsVUFBSSxLQUFLLFNBQVMsa0JBQWtCO0FBQ25DLGNBQU0sZUFBZSxLQUFLLGNBQ3pCLGlCQUNBLFdBQ0EsQ0FBQyxRQUFvQjtBQUNwQixlQUFLO0FBQUE7QUFBQTtBQUtSLFdBQUssV0FBVztBQUFBLFFBQ2YsSUFBSTtBQUFBLFFBQ0osTUFBTTtBQUFBLFFBQ04sZ0JBQWdCLENBQUMsUUFBZ0IsU0FBdUI7QUFDdkQsZUFBSztBQUFBO0FBQUE7QUFJUCxXQUFLLGNBQWMsSUFBSSxrQkFBa0IsS0FBSyxLQUFLO0FBQUE7QUFBQTtBQUFBLEVBR3BELFdBQVc7QUFBQTtBQUFBLEVBRUwsZUFBZTtBQUFBO0FBQ3BCLFdBQUssV0FBVyxPQUFPLE9BQ3RCLElBQ0Esa0JBQ0EsTUFBTSxLQUFLO0FBQUE7QUFBQTtBQUFBLEVBSVAsZUFBZTtBQUFBO0FBQ3BCLFlBQU0sS0FBSyxTQUFTLEtBQUs7QUFBQTtBQUFBO0FBQUE7QUFJM0Isc0NBQWdDLGlDQUFpQjtBQUFBLEVBR2hELFlBQVksS0FBVSxRQUFpQjtBQUN0QyxVQUFNLEtBQUs7QUFDWCxTQUFLLFNBQVM7QUFBQTtBQUFBLEVBR2YsVUFBZ0I7QUFDZixVQUFNLEVBQUUsZ0JBQWdCO0FBRXhCLGdCQUFZO0FBRVosUUFBSSx3QkFBUSxhQUNWLFFBQVEsc0JBQ1IsUUFDQSxzSEFFQSxVQUFVLENBQUMsV0FBVztBQUN0QixhQUNFLFNBQVMsS0FBSyxPQUFPLFNBQVMsa0JBQzlCLFNBQVMsQ0FBQyxxQkFBcUI7QUFDL0IsYUFBSyxPQUFPLFNBQVMsbUJBQ3BCO0FBQ0QsYUFBSyxPQUFPO0FBQUE7QUFBQTtBQUFBO0FBQUE7IiwKICAibmFtZXMiOiBbXQp9Cg==
